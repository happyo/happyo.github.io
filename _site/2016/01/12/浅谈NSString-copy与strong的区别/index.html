<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
      <title>hikari - Fluid, responsive blog theme for Jekyll</title>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <meta http-equiv="content-language" content="en-gb" />
      <meta name="description" content="Fluid, responsive blog theme for Jekyll">
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
      <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,400,300,700|Lora:400,700,400italic" rel="stylesheet" type="text/css">
      <link rel="stylesheet" type="text/css" href="/hikari-for-jekyll/css/main.css" />
      <link href="atom.xml" type="application/atom+xml" rel="alternate" title="Site ATOM Feed">
  </head>

  <body>
    <!--[if lt IE 7]>
        <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    <div class="off-canvas">
      <figure class="avatar">
        <img src="/hikari-for-jekyll/assets/img/avatar.jpg" alt="Picture" title="That's me, John Doge.">
      </figure>
      <div class="bio">
          <h1>Hi, I'm John Doge.</h1>
          <p>I'm a dog. I develop things. This is my blog so why don't you close this damn side panel (cursed by most UX Designers but I don't care, I do whatever I want) and start reading my awesome stuff?</p>
      </div>
      <nav>
        <h6>Follow me on</h6>
        <ul>
          
          <li><a target="_blank" href="https://twitter.com/mx3m">Twitter</a></li>
          
          
          <li><a target="_blank" href="https://github.com/m3xm">Github</a></li>
          
          
          <li><a target="_blank" href="https://dribbble.com/m3xm">Dribbble</a></li>
          
          
          <li><a target="_blank" href="https://instagram.com/m3xm">Instagram</a></li>
          
        </ul>
      </nav>
    </div>


    <div class="site-wrapper">

      <header>
        <div class="h-wrap">
          <h1 class="title"><a href="/hikari-for-jekyll/" title="Back to Homepage">hikari</a></h1>
          <a class="menu-icon" title="Open Bio"><span class="lines"></span></a>
        </div>
      </header>

      <main>
        <section class="single-wrap">
  <article class="single-content" itemscope itemtype="http://schema.org/BlogPosting">
    <div class="feat">
      <h5 class="page-date">
        <time datetime="2016-01-12T14:10:54+08:00" itemprop="datePublished">
          12 January 2016
        </time>
      </h5>
    </div>
    <h1 class="page-title" itemprop="name headline">浅谈NSString copy与strong的区别</h1>
    <div itemprop="articleBody">
      <blockquote>
  <p>最近在看面试题，刚好遇到<code>copy</code>用法的问题。而我对答案不是很理解，所以晚上搜了一些相关知识，然后自己手动试了下。</p>
</blockquote>

<h1 id="先贴下面试题及答案">先贴下面试题及答案</h1>
<hr />
<h2 id="题目怎么使用copy关键字">题目：怎么使用<code>copy</code>关键字</h2>

<p>回答：<code>NSString、NSArray、NSDictionary</code> 等等经常使用<code>copy</code>关键字，是因为他们有对应的可变类型：<code>NSMutableString、NSMutableArray、NSMutableDictionary</code></p>

<p>对此不是很理解，所以就找了下<code>copy</code>的解释。</p>

<p>Copy</p>

<p>copy is required when the object is mutable. Use this if you need the value of the object as it is at this moment, and you don’t want that value to reflect any changes made by other owners of the object. You will need to release the object when you are finished with it because you are retaining the copy.</p>

<p>大概意思是不想本类的属性随外面的变化而变化时使用。</p>

<h1 id="talk-is-cheapshow-me-the-code">Talk is cheap,show me the code.</h1>
<hr />
<p>首先先创建两个<code>NSString</code>的属性，一个为<code>copy</code>，一个为<code>strong</code>。</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><span></span><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">copy</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">strCopy</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">strStrong</span><span class="p">;</span></code></pre></figure>

<p>然后创建一个<code>NSString</code>对象，将其赋值给这两个属性，并打印出变量值和地址。修改<code>NSString</code>，再打印出两个属性的值和地址。</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><span></span><span class="bp">NSString</span> <span class="o">*</span><span class="n">strChange</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;hello&quot;</span><span class="p">];</span>
<span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span> <span class="o">=</span> <span class="n">strChange</span><span class="p">;</span>
<span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span> <span class="o">=</span> <span class="n">strChange</span><span class="p">;</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Before change~~~&quot;</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Copy string: %@ ,%p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Strong string: %@, %p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Change string: %@, %p;&quot;</span><span class="p">,</span> <span class="n">strChange</span><span class="p">,</span> <span class="n">strChange</span><span class="p">);</span>

<span class="n">strChange</span> <span class="o">=</span> <span class="s">@&quot;world&quot;</span><span class="p">;</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;After change~~~&quot;</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Copy string: %@ ,%p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Strong string: %@, %p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Change string: %@, %p;&quot;</span><span class="p">,</span> <span class="n">strChange</span><span class="p">,</span> <span class="n">strChange</span><span class="p">);</span></code></pre></figure>

<p>结果如下</p>

<p><img src="http://cl.ly/2g061W2K0P04/Image%202016-01-12%20at%204.06.49%20%E4%B8%8B%E5%8D%88.png" alt="result" /></p>

<p>可见，<strong>当赋值类型是不可变的<code>NSString</code>时，不管是<code>copy</code>还是<code>strong</code>，都是将其指针直接赋值过去。</strong><code>NSString</code>发生变化，其指针会发生变化，不会对属性造成影响。</p>

<p>将<code>strChange</code>的类型改为<code>NSMutableString</code>，然后对其修改。</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><span></span><span class="bp">NSMutableString</span> <span class="o">*</span><span class="n">strChange</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;hello&quot;</span><span class="p">];</span>
<span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span> <span class="o">=</span> <span class="n">strChange</span><span class="p">;</span>
<span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span> <span class="o">=</span> <span class="n">strChange</span><span class="p">;</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Before change~~~&quot;</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Copy string: %@ ,%p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Strong string: %@, %p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Change string: %@, %p;&quot;</span><span class="p">,</span> <span class="n">strChange</span><span class="p">,</span> <span class="n">strChange</span><span class="p">);</span>

<span class="p">[</span><span class="n">strChange</span> <span class="nl">insertString</span><span class="p">:</span><span class="s">@&quot;world&quot;</span> <span class="nl">atIndex</span><span class="p">:</span><span class="mi">4</span><span class="p">];</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;After change~~~&quot;</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Copy string: %@ ,%p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Strong string: %@, %p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Change string: %@, %p;&quot;</span><span class="p">,</span> <span class="n">strChange</span><span class="p">,</span> <span class="n">strChange</span><span class="p">);</span></code></pre></figure>

<p>结果如下：</p>

<p><img src="http://cl.ly/020Z312W233b/Image%202016-01-12%20at%205.08.18%20%E4%B8%8B%E5%8D%88.png" alt="mutable result" /></p>

<p>可见，<strong>当赋值类型是可变的<code>NSMutableString</code>时<code>copy</code>会将<code>changeStr</code>重新拷贝一份并将新的指针赋值给属性。而<code>strong</code>则还是直接将<code>changeStr</code>的指针赋值过去。</strong>所以当我们对<code>changeStr</code>进行改变时，<code>copy</code>属性不会受到影响，<code>strong</code>类型则会跟着改变。</p>

<h1 id="结论">结论</h1>
<hr />
<p><strong>当属性是<code>NSString,NSArray,NSDictionary</code>这种不可变的类型时，我们一般不希望它随着外界变化而变化，所以最好使用<code>copy</code>。</strong></p>

    </div>
    <div class="feat share">
      <a href="http://twitter.com/share" class="popup">
        <span class="icon-twitter"></span>
      </a>
    </div>
    
      <a rel="next" href="/hikari-for-jekyll/2016/01/18/iOS-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/" id="next">
        <span class="nav-title nav-title-next">newer</span> &rarr;
      </a>
    
    
  </article>
</section>

      </main>

      <footer>
        <small>Powered by Jekyll - Theme: <a href="https://github.com/m3xm/hikari-for-Jekyll">hikari</a> - &copy; John Doge</small>
      </footer>

    </div>
    

    <script src="/hikari-for-jekyll/js/main.js"></script>
    
    
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-47727049-1', 'm3xm.github.io');
        ga('send', 'pageview');
      </script>
    

  </body>
</html>
