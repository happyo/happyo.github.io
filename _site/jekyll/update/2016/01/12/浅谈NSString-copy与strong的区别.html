<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>浅谈NSString copy与strong的区别</title>
  <meta name="description" content="  最近在看面试题，刚好遇到copy用法的问题。而我对答案不是很理解，所以晚上搜了一些相关知识，然后自己手动试了下。">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://happyo.github.io/jekyll/update/2016/01/12/%E6%B5%85%E8%B0%88NSString-copy%E4%B8%8Estrong%E7%9A%84%E5%8C%BA%E5%88%AB.html">
  <link rel="alternate" type="application/rss+xml" title="happyo" href="https://happyo.github.io/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">happyo</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">浅谈NSString copy与strong的区别</h1>
    <p class="post-meta"><time datetime="2016-01-12T14:10:54+08:00" itemprop="datePublished">Jan 12, 2016</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <blockquote>
  <p>最近在看面试题，刚好遇到<code>copy</code>用法的问题。而我对答案不是很理解，所以晚上搜了一些相关知识，然后自己手动试了下。</p>
</blockquote>

<h3 id="section">先贴下面试题及答案</h3>

<h4 id="copy">题目：怎么使用<code>copy</code>关键字</h4>

<h4 id="nsstringnsarraynsdictionary-copynsmutablestringnsmutablearraynsmutabledictionary">回答：<code>NSString、NSArray、NSDictionary</code> 等等经常使用<code>copy</code>关键字，是因为他们有对应的可变类型：<code>NSMutableString、NSMutableArray、NSMutableDictionary</code></h4>

<p><br /></p>

<p>对此不是很理解，所以就找了下<code>copy</code>的解释。</p>

<p>Copy</p>

<p>copy is required when the object is mutable. Use this if you need the value of the object as it is at this moment, and you don’t want that value to reflect any changes made by other owners of the object. You will need to release the object when you are finished with it because you are retaining the copy.</p>

<p>大概意思是不想本类的属性随外面的变化而变化时使用。</p>

<p><br /></p>

<h3 id="talk-is-cheapshow-me-the-code">Talk is cheap,show me the code.</h3>

<p>首先先创建两个<code>NSString</code>的属性，一个为<code>copy</code>，一个为<code>strong</code>。</p>

<figure class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">copy</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">strCopy</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">strStrong</span><span class="p">;</span></code></pre></figure>

<p>然后创建一个<code>NSString</code>对象，将其赋值给这两个属性，并打印出变量值和地址。修改<code>NSString</code>，再打印出两个属性的值和地址。</p>

<figure class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="bp">NSString</span> <span class="o">*</span><span class="n">strChange</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;hello&quot;</span><span class="p">];</span>
<span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span> <span class="o">=</span> <span class="n">strChange</span><span class="p">;</span>
<span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span> <span class="o">=</span> <span class="n">strChange</span><span class="p">;</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Before change~~~&quot;</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Copy string: %@ ,%p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Strong string: %@, %p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Change string: %@, %p;&quot;</span><span class="p">,</span> <span class="n">strChange</span><span class="p">,</span> <span class="n">strChange</span><span class="p">);</span>
 
<span class="n">strChange</span> <span class="o">=</span> <span class="s">@&quot;world&quot;</span><span class="p">;</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;After change~~~&quot;</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Copy string: %@ ,%p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Strong string: %@, %p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Change string: %@, %p;&quot;</span><span class="p">,</span> <span class="n">strChange</span><span class="p">,</span> <span class="n">strChange</span><span class="p">);</span></code></pre></figure>

<p>结果如下</p>

<p><img src="http://cl.ly/2g061W2K0P04/Image%202016-01-12%20at%204.06.49%20%E4%B8%8B%E5%8D%88.png" alt="result" /></p>

<p>可见，<em>*当赋值类型是不可变的<code>NSString</code>时，不管是<code>copy</code>还是<code>strong</code>，都是将其指针直接赋值过去。</em><code>NSString</code>发生变化，其指针会发生变化，不会对属性造成影响。</p>

<p>将<code>strChange</code>的类型改为<code>NSMutableString</code>，然后对其修改。</p>

<figure class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="bp">NSMutableString</span> <span class="o">*</span><span class="n">strChange</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;hello&quot;</span><span class="p">];</span>
<span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span> <span class="o">=</span> <span class="n">strChange</span><span class="p">;</span>
<span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span> <span class="o">=</span> <span class="n">strChange</span><span class="p">;</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Before change~~~&quot;</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Copy string: %@ ,%p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Strong string: %@, %p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Change string: %@, %p;&quot;</span><span class="p">,</span> <span class="n">strChange</span><span class="p">,</span> <span class="n">strChange</span><span class="p">);</span>

<span class="p">[</span><span class="n">strChange</span> <span class="nl">insertString</span><span class="p">:</span><span class="s">@&quot;world&quot;</span> <span class="nl">atIndex</span><span class="p">:</span><span class="mi">4</span><span class="p">];</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;After change~~~&quot;</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Copy string: %@ ,%p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strCopy</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Strong string: %@, %p;&quot;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">strStrong</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Change string: %@, %p;&quot;</span><span class="p">,</span> <span class="n">strChange</span><span class="p">,</span> <span class="n">strChange</span><span class="p">);</span></code></pre></figure>

<p>结果如下：</p>

<p><img src="http://cl.ly/020Z312W233b/Image%202016-01-12%20at%205.08.18%20%E4%B8%8B%E5%8D%88.png" alt="mutable result" /></p>

<p>可见，<strong>当赋值类型是可变的<code>NSMutableString</code>时<code>copy</code>会将<code>changeStr</code>重新拷贝一份并将新的指针赋值给属性。而<code>strong</code>则还是直接将<code>changeStr</code>的指针赋值过去。</strong>所以当我们对<code>changeStr</code>进行改变时，<code>copy</code>属性不会受到影响，<code>strong</code>类型则会跟着改变。</p>

<p>结论：
<strong>当属性是<code>NSString,NSArray,NSDictionary</code>这种不可变的类型时，我们一般不希望它随着外界变化而变化，所以最好使用<code>copy</code>。</strong></p>

  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">happyo</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>happyo's email</li>
          <li><a href="mailto:happyojones@gmail.com">happyojones@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/happyo"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">happyo</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/happyojones"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">happyojones</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
